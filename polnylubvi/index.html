<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <title>полны любви</title>

  <!-- favicon (общий для aparte.band и aparte.band/polnylubvi/) -->
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <!-- Preload assets -->
  <link rel="preload" as="video" href="video.mp4" type="video/mp4" />
  <link rel="preload" as="image" href="release_title.png" />
  <link rel="preload" as="image" href="spotify.png" />
  <link rel="preload" as="image" href="apple.png" />
  <link rel="preload" as="image" href="zvuk.png" />
  <link rel="preload" as="image" href="kion.png" />
  <link rel="preload" as="image" href="vk.png" />
  <link rel="preload" as="image" href="yandex.png" />

  <style>
    :root {
      /* iOS vh fix */
      --vh: 1vh;

      /* pink plaque */
      --plaque-color: 253 176 192; /* #fdb0c0 */
      --plaque-alpha: 0.65;        /* прозрачность сохраняем (можно подправить при желании) */

      /* layout */
      --video-shift: 10;           /* опускаем видео на 10% вниз => низ обрезан */
    }

    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      width: 100%;
      height: 100%;
      overflow: hidden;
      -webkit-text-size-adjust: 100%;
      overscroll-behavior: none;
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    /* full stage */
    #stage {
      position: fixed;
      inset: 0;
      overflow: hidden; /* режем всё, что выходит за пределы */
    }

    /* --- VIDEO (left edge, bottom, shifted down by 10% => bottom clipped) --- */
    #leftVideo {
      position: fixed;
      left: 0;
      bottom: calc(var(--vh) * (-1 * var(--video-shift)));
      height: calc(var(--vh) * 90);
      width: clamp(220px, 36vw, 560px);
      object-fit: contain;
      pointer-events: none;
      z-index: 1;
      transform: translateZ(0);
      will-change: transform;
    }

    /* --- Pink plaque (2x smaller, centered like before) --- */
    #plaque {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: clamp(140px, 18vw, 220px); /* в 2 раза меньше (адаптивно) */
      aspect-ratio: 1 / 1.54;           /* вертикальный прямоугольник */
      background: rgba(var(--plaque-color), var(--plaque-alpha));
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* column of streaming icons inside plaque */
    #streams {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: clamp(10px, 1.2vh, 16px);
      padding: clamp(10px, 1.8vh, 16px);
      box-sizing: border-box;
      pointer-events: auto;
    }

    .streamLink {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      outline: none;
    }

    .streamLink:focus-visible {
      outline: 2px solid rgba(255,255,255,0.85);
      outline-offset: 4px;
      border-radius: 6px;
    }

    .streamIcon {
      display: block;
      width: clamp(84px, 10.5vw, 140px);
      height: auto;
      opacity: 0.95;
      transform: translateZ(0);
    }

    @media (hover: hover) {
      .streamLink:hover .streamIcon {
        opacity: 1;
      }
    }

    /* --- Center title image --- */
    #releaseTitle {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: min(86vw, 760px);
      height: auto;
      z-index: 3;
      pointer-events: none;
      user-select: none;
      -webkit-user-select: none;
      transform-origin: center;
    }

    /* Mobile tuning: keep things readable and avoid covering everything */
    @media (max-width: 520px) {
      #leftVideo {
        width: clamp(190px, 54vw, 320px);
        height: calc(var(--vh) * 88);
      }

      #plaque {
        width: clamp(160px, 44vw, 220px);
      }

      .streamIcon {
        width: clamp(86px, 34vw, 140px);
      }

      #releaseTitle {
        width: min(92vw, 560px);
      }
    }
  </style>
</head>

<body>
  <div id="stage" aria-hidden="true"></div>

  <!-- Video: muted, no sound, loop, autoplay, inline -->
  <video
    id="leftVideo"
    src="video.mp4"
    muted
    playsinline
    autoplay
    loop
    preload="auto"
  ></video>

  <!-- Pink plaque with streaming icons column -->
  <div id="plaque">
    <nav id="streams" aria-label="Ссылки на стриминги">
      <a class="streamLink" href="https://vk.ru/audio-2001043938_136043938%D1%81%D0%BF%D0%BE%D1%82%D0%B8%D0%BA" target="_blank" rel="noopener noreferrer" aria-label="Spotify">
        <img class="streamIcon" src="spotify.png" alt="Spotify" draggable="false" />
      </a>

      <a class="streamLink" href="https://music.apple.com/ru/album/%D0%BF%D0%BE%D0%BB%D0%BD%D1%8B-%D0%BB%D1%8E%D0%B1%D0%B2%D0%B8/1808785284?i=1808785286" target="_blank" rel="noopener noreferrer" aria-label="Apple Music">
        <img class="streamIcon" src="apple.png" alt="Apple Music" draggable="false" />
      </a>

      <a class="streamLink" href="https://share.zvuk.com/cLQ0/9bw5ym1b" target="_blank" rel="noopener noreferrer" aria-label="Звук">
        <img class="streamIcon" src="zvuk.png" alt="Звук" draggable="false" />
      </a>

      <a class="streamLink" href="https://mts-music-spo.onelink.me/sKFX/ex58sdmo" target="_blank" rel="noopener noreferrer" aria-label="Кион">
        <img class="streamIcon" src="kion.png" alt="Кион" draggable="false" />
      </a>

      <a class="streamLink" href="https://vk.ru/audio-2001043938_136043938" target="_blank" rel="noopener noreferrer" aria-label="ВК Музыка">
        <img class="streamIcon" src="vk.png" alt="ВК" draggable="false" />
      </a>

      <a class="streamLink" href="https://music.yandex.ru/album/36297300/track/138373316?ref_id=4BDABF68-5903-4C4A-98A7-35D7E17B8213&utm_medium=copy_link" target="_blank" rel="noopener noreferrer" aria-label="Яндекс Музыка">
        <img class="streamIcon" src="yandex.png" alt="Яндекс" draggable="false" />
      </a>
    </nav>
  </div>

  <!-- Center release title -->
  <img id="releaseTitle" src="release_title.png" alt="" draggable="false" />

  <script>
    /* ============================================================
       iOS VIEWPORT HEIGHT FIX (vh стабилизация на iOS / in-app)
       — не меняет тайминги, только стабилизирует геометрию
    ============================================================ */
    (function () {
      if (window.__vhFixV1_polny) return;
      window.__vhFixV1_polny = true;

      function setVhVar() {
        var h = (window.visualViewport && typeof window.visualViewport.height === "number")
          ? window.visualViewport.height
          : window.innerHeight;

        document.documentElement.style.setProperty("--vh", (h * 0.01) + "px");
      }

      setVhVar();
      window.addEventListener("resize", setVhVar);
      window.addEventListener("orientationchange", setVhVar);
      if (window.visualViewport) {
        window.visualViewport.addEventListener("resize", setVhVar);
        window.visualViewport.addEventListener("scroll", setVhVar);
      }
    })();

    /* ============================================================
       Trailing slash safety for GitHub Pages (aparte.band/polnylubvi/)
    ============================================================ */
    (function () {
      var p = window.location.pathname || "";
      if (/\/polnylubvi$/.test(p)) {
        window.location.replace(p + "/");
      }
    })();

    /* ============================================================
       Autoplay robustness (muted). No UI, no controls.
    ============================================================ */
    (function () {
      var v = document.getElementById("leftVideo");
      if (!v) return;

      function tryPlay() {
        try {
          var pr = v.play();
          if (pr && typeof pr.catch === "function") pr.catch(function(){});
        } catch (e) {}
      }

      // preload + initial play
      v.preload = "auto";
      v.muted = true;
      v.playsInline = true;
      tryPlay();

      // retry on first user interaction (some browsers require gesture)
      window.addEventListener("pointerdown", tryPlay, { once: true, passive: true });
      window.addEventListener("touchstart", tryPlay, { once: true, passive: true });

      // if tab returns to foreground
      document.addEventListener("visibilitychange", function () {
        if (!document.hidden) tryPlay();
      });
    })();
  </script>
</body>
</html>
